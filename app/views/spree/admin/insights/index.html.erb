<% content_for :page_title do %>
  <%= Spree.t(:heading, type: params[:type].to_s.titleize, scope: :insight) %>
<% end %>

<% content_for :title do %>
  <%= Spree.t(:heading, type: params[:type].to_s.titleize, scope: :insight) %>
<% end %>

<%= select_tag :reports, options_for_select(@reports.map { |report_name| [report_name.to_s.humanize, report_name, data: { url: admin_insight_url(report_name, type: params[:type]) }] }, [params[:id]]), include_blank: 'Select a report', class: 'select2' %>

<%= content_tag :div, class: 'hidden report-data', data: { report_data: @report_data_json } {} %>

<div id='search-div' class='hide'>
  <div class="filter-wrap row">
    <div class="col-sm-12">
      <div class="input-group index-filter-button">
        <span class="input-group-btn">
          <button class="btn btn-default js-show-index-filters" type="button">
            <span class="icon icon-chevron-right"></span>
            <%= Spree.t(:filter) %>
          </button>
        </span>
        <%= form_tag form_action(@report_name, params[:type]), id: "quick-search" do %>
          <%= text_field_tag :quick_search, nil, class: "form-control js-quick-search", placeholder: Spree.t(:quick_search) %>
        <% end %>
      </div>
      <div id="table-filter" data-hook class="well filter-well">
        <%= render partial: 'spree/admin/insights/search/search_form' %>
      </div>
    </div>
  </div>

  <div class="table-active-filters js-filters"></div>
</div>

<div id='report-div'>
</div>

<div id='paginator-div'>
</div>

<script type="text/x-tmpl" id="tmpl">
  <table class="table admin-insight table-hover" id="admin-insight">
    <thead>
      <tr>
        {% for(var i = 0; i < o['headers'].length; i++) { %}
          <th><a href="{%= o['request_path'] %}?type={%= o['report_type'] %}&sort%5Battribute%5D={%= o['headers'][i].value %}&sort%5Btype%5D={%= (o['headers'][i].sorted == 'asc') ? 'desc' : 'asc' %}" class="sortable-link {%= o['headers'][i].sorted %}">{%= o['headers'][i].name %}</a></th>
        {% } %}
      </tr>
    </thead>
    <tbody class='table-data'>
      {% for(var i = 0; i < o['stats'].length; i++) { %}
        <tr>
          {% for(var j = 0; j < o['headers'].length; j++) { %}
            <td>{%= o['stats'][i][o['headers'][j].value] %}</td>
          {% } %}
        </tr>
      {% } %}
    </tbody>
  </table>

</script>

<script type="text/x-tmpl" id="paginator-tmpl">
  {% if(o['total_pages'] > 0) { %}
    {% for(var i = 0; i <= o['total_pages']; i++) { %}
      <a href="{%= o['url'] %}&page={%= i %}" class="pagination-link">{%= i+1 %}</a>
    {% } %}
  {% } %}
</script>


<script type="text/x-tmpl" id="sorted-insights-data">
  {% for(var i = 0; i < o['stats'].length; i++) { %}
    <tr>
      {% for(var j = 0; j < o['headers'].length; j++) { %}
        <td>{%= o['stats'][i][o['headers'][j].value] %}</td>
      {% } %}
    </tr>
  {% } %}
</script>
